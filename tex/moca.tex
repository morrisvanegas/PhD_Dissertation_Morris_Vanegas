% moca.tex:

\chapter{MODULAR OPTODE CONFIGURATION ANALYZER (MOCA)} % all caps please
\label{chap:moca}

%%% Section %%% 
\section{Introduction}
\label{sec:introduction}
Functional near-infrared spectroscopy (fNIRS) is an emerging neuroimaging technique to non-invasively measure brain activity using non-ionizing light~\cite{Ferrari2012}. Unlike functional magnetic resonance imaging (fMRI)~\cite{Heinzel2013} that requires high-strength magnetic fields and large scanners, fNIRS utilizes near-infrared (NIR) light to detect brain activation by measuring the associated hemodynamics. The portability of fNIRS positions it as a competitive imaging modality to address some of the challenges of conventional neuroimaging techniques, such as fMRI and magnetoencephalography (MEG), including a lack of wearability for continuous monitoring, limited temporal resolution, and need for subject immobility during use~\cite{Yucel2017}. It has shown great promise for safe and long-term monitoring of brain activity and is increasingly used in studies for behavioral~\cite{McDonald2018} and cognitive neurodevelopment~\cite{Aslin2015, Vanderwert2014, Wilcox2015, Soltanlou2018}, language~\cite{Quaresima2012, Rossi2012}, psychiatric conditions~\cite{Ehlis2014, Kumar2017}, stroke recovery~\cite{Yang2019}, and brain-computer interfaces~\cite{Naseer2015, Ahn2017, Hong2018}. 

Despite an exponential growth in the number of applications~\cite{Boas2014, Quaresima2019} and publications~\cite{Yucel2017} in recent years, many fNIRS systems still employ fiber-based, cart-sized instrumentation~\cite{Scholkmann2014} that place limits on both channel density and the use of fNIRS in natural environments. Although fiber-based high-density~\cite{Eggebrecht2014} and portable~\cite{Wheelock2019} fNIRS systems have been demonstrated, the use of fragile fiber optics cables, stationary external source/detector units~\cite{Oxymon2017, Techen2018}, and the need for individual and specialized headgear for specific tasks have motivated the fNIRS community to investigate more flexible modular and fiber-less designs~\cite{Zhao2017, Curtin2018}.

The modular fNIRS architecture is based on utilizing elementary optical source and detector circuits (modules) as repeating building blocks to form a re-configurable probe~\cite{Zhao2017}. This modular architecture offers significantly improved portability, scalability, flexibility in coverage, and fabrication cost~\cite{Zhao2017}. By avoiding the use of fragile optical fibers, modular fNIRS systems permit the use of light guides to directly couple light sources and detectors to the scalp, significantly reducing signal loss due to fiber coupling. The lightweight and compact modules also make wearable fNIRS and continuous monitoring in mobile environments possible~\cite{Yucel2017, Park2018}. In addition, the ability to use both intra-module (within a single module) and inter-module (source and detector on different modules) channels allows for high density probes with varying source-to-detector separations (SDS) that increase measurement density and tissue depth sampling, resulting in enhanced signal quality, and easy removal of physiological noise~\cite{Gregg2010}. 

\updated{Despite these perceived benefits, the task of designing a modular fNIRS probe can quickly grow in complexity as the number of modules increases. While parameters can be empirically determined when designing a single module, understanding the trade-offs among a large array of parameters, including module shape, module size, optode quantities, and optode locations, and each parameter's effects on the final probe can become a daunting task. Not only do most published modular fNIRS studies largely focused on the design of a single module without addressing the effect of these module- and probe-level parameters on the final probe, the current literature also does not provide a means to compare probes composed of different module designs.}

Aside from \updated{the challenges of determining these modular probe} core parameters, other factors such as mechanical, ergonomic, safety, usability, optoelectronic, and data communication considerations~\cite{Zhao2017} also play important roles in achieving the desired performance. For example, mechanical features such as optical coupling and \updated{electronic circuitry} encapsulation must be considered alongside ergonomic considerations such as comfort, weight, and robustness. Additionally, the use of high density light sources in such modular probes brings about additional safety considerations, such as heat dissipation, driving voltage, and battery life. Moreover, optoelectronic considerations arise from the use of specialized optodes with narrow emission bandwidths, high gains, low noise, and fNIRS-optimized wavelengths. Not only are these specialized optodes more expensive due to their niche applications and characteristics, they also require more complex control electronics for driving optodes and acquiring data. With such dense coverage, complex encoding strategies such as frequency~\cite{Maki1995} multiplexing become a necessity for obtaining high \updated{density} data acquisition to achieve sufficient spatial and temporal resolution. Finally, while previously reported modular fNIRS systems often employ daisy-chain communication protocols to connect multiple modules on a single bus~\cite{Chitnis2016, Bci2017, Zimmermann2013, Funane2017, Zhao2019}, the design of physical inter-module connections~\cite{Zhao2021}, the synchronization method between modules~\cite{Zhao2017}, and the transfer of acquired data become increasingly complex with high module counts and branching connections.

\updated{Along these lines, a number of fNIRS data analysis packages exists~\cite{Huppert2009, Santosa2018, Hernandez2020}. However, they focus on the statistical analysis of the data ~\cite{Hernandez2020,Huppert2009, Santosa2018} to enhance its quality and provide guidance on post-processing steps such as motion artifact correction~\cite{Huppert2009}.} \updated{While some other tools exist to assist in the probe design~\cite{Brigadoi2018, Machado2018, ZimeoMorais2018, Aasted2015}, most of these tools are designed to work in a highly constrained design space, where the probe parameters are mostly pre-determined by the user. As a result, the best practices and trade-offs in modular probe design such as tessellation, connection, or re-orientation are poorly explored and understood. Therefore, the community is in great need of an easy-to-use software tool to assist the exploration of and quantitative comparisons among countless parameter choices in a modular probe design and to perform a limited degree of optimization within a well-constrained configuration}. 

\updated{A fully-automated probe design and optimization pipeline is impractical without application-dependent design constraints. Instead, we report a simplified, easy-to-use software toolbox to help designers navigate the vast parameter space of a modular probe. We also share a number of fundamental modular probe design strategies, discovered through our explorations via this toolbox, that are not widely recognized or previously studied.} The entire workflow has been implemented into an open-source, MATLAB-based toolbox called Modular Optode Configuration Analyzer (MOCA~\cite{Vanegas2020}). MOCA supports a list of commonly used module shapes, user-defined optode layouts, and region-of-interest (ROI) coverage, and can produce quantitative performance metrics such as distributions of source-detector (SD) separations, sensitivity maps, and spatial multiplexing groupings. These performance metrics also allow comparisons between different designs of modular probes. \updated{Although MOCA is not designed as a fully-automated software that produces ``optimal'' probes regardless of application, its unique capability to describe and sweep modular probe parameters in operator-guided interrogations offers valuable perspective to start approaching the complex modular hardware design problem and make informed comparisons between well-constrained design choices.}

The remainder of the paper is outlined below. In Section~\ref{sec:overview}, we discuss the relevant design considerations when developing a modular probe using MOCA. We specifically focus on the parameterization of the modules, processes required to assemble modules into functional probes, and related performance metrics for system characterization and comparisons. In Section~\ref{sec:results}, we demonstrate MOCA's capability in designing full-head probes using a variety of module shapes and compare their trade-offs regarding channel density, SD separations, and average brain sensitivities. Furthermore, we utilize MOCA to showcase potential improvements to published fNIRS probes by \updated{altering} module orientations, spacing, and staggering layouts. \updated{In Section~\ref{sec:discussion}, we highlight a number of generalizable design strategies that were discovered via our experiments using MOCA, including the importance of considering module orientations, tiling strategies, and module spacing tuning, among others.}

